git clone git@github.com:sonia-auv/ros_sonia_ws.git $ROS_SONIA_WS
cd $ROS_SONIA_WS
git checkout develop
$ROS_SONIA_WS/git_update.sh
sudo ldconfig

## setup ros
sudo rosdep init
rosdep update

## apply patch
cd ~
mkdir patch
cd patch
wget http://sonia-auv.readthedocs.org/assets/files/patch.tar.gz -O ./patch.tar.gz
tar -xvf ./patch.tar.gz
sudo patch /usr/include/mlpack/methods/kmeans/kmeans_impl.hpp kmeans.patch
sudo patch /opt/ros/kinetic/include/opencv-3.3.1/opencv2/core/traits.hpp traits.patch
if [ ! -f /tmp/foo.txt ]; then
    sudo patch ~/.config/pip/pip.conf pip_conf.patch
fi


# ask for the sonia version
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python
export WORKON_HOME=~/.virtualenvs
source /usr/local/bin/virtualenvwrapper.sh
workon virtual_babe
echo "Quelle version du script vous voulez installer?"
select ask in "Devel" "Prod" "Annuler"; do
    case $ask in
        Devel ) sudo patch ~/.bash_sonia devel.patch
                sudo pip3 install $ROS_SONIA_WS/requirements/develop.txt
                break;;
        Prod )  sudo patch ~/.bash_sonia prod.patch
                sudo pip3 install $ROS_SONIA_WS/requirements/prod.txt
                break;;
        Annuler ) break;;
    esac
done
deactivate

cd ..
rm -rf patch
cd $ROS_SONIA_WS

## compile
catkin_make -j8 -DCMAKE_CXX_FLAGS="-O2"
source devel/setup.bash
